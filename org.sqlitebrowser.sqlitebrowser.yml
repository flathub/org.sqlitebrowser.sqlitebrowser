app-id: org.sqlitebrowser.sqlitebrowser
runtime: org.kde.Platform
runtime-version: 5.15-25.08
sdk: org.kde.Sdk
command: sqlitebrowser
rename-icon: sqlitebrowser
rename-desktop-file: sqlitebrowser.desktop
rename-appdata-file: sqlitebrowser.desktop.appdata.xml
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --filesystem=home
  - --share=network
  - --share=ipc
cleanup:
  - /include
  - '*.la'

modules:
  - tcl.json
  - name: sqlcipher
    buildsystem: autotools
    build-options:
      cflags: >
        -DSQLCIPHER_CRYPTO_OPENSSL
        -DSQLITE_ENABLE_COLUMN_METADATA
        -DSQLITE_ENABLE_FTS3
        -DSQLITE_ENABLE_FTS3_PARENTHESIS
        -DSQLITE_ENABLE_FTS5
        -DSQLITE_ENABLE_GEOPOLY
        -DSQLITE_ENABLE_JSON1
        -DSQLITE_ENABLE_MEMORY_MANAGEMENT=1
        -DSQLITE_ENABLE_RTREE
        -DSQLITE_ENABLE_SNAPSHOT=1
        -DSQLITE_ENABLE_STAT4
        -DSQLITE_HAS_CODEC
        -DSQLITE_SOUNDEX
    config-opts:
      - --enable-tempstore=yes
      - --enable-releasemode
      - --enable-load-extension
      - --disable-static
      - --disable-tcl
      - --with-crypto-lib=openssl
    sources:
      - type: git
        url: https://github.com/sqlcipher/sqlcipher.git
        tag: v4.6.1

  - name: sqlitebrowser
    buildsystem: cmake-ninja
    config-opts:
      - -DFORCE_INTERNAL_QSCINTILLA=TRUE
      - -Dsqlcipher=1
      - -Wno-dev
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    sources:
      - type: git
        url: https://github.com/sqlitebrowser/sqlitebrowser.git
        tag: v3.13.1
        commit: 5d84f53f85570a31767548cded89c96de6ff70ae
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      - type: patch
        path: appdata.patch
